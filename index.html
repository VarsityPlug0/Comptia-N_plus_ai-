<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>NetQuiz ‚Äì Smart Networking Study Coach</title>
    <meta name="description" content="AI-powered networking quiz with progress tracking and learning roadmap">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="header-top">
                <div class="header-brand">
                    <h1>‚ö° NetQuiz</h1>
                    <p class="subtitle">Smart Networking Study Coach</p>
                </div>
                <span class="header-user" id="header-user-info"></span>
            </div>
            <nav class="header-nav">
                <button class="nav-btn" onclick="goHome()" title="Home">üè†</button>
                <button class="nav-btn" onclick="showDashboard()" title="Progress">üìä</button>
                <button class="nav-btn" onclick="showRoadmapView()" title="Roadmap">üó∫Ô∏è</button>
                <button class="nav-btn" onclick="showSettings()" title="Settings">‚öôÔ∏è</button>
                <button class="nav-btn" onclick="logout()" title="Logout">üö™</button>
            </nav>
        </header>

        <!-- Login View -->
        <div id="login" class="view active">
            <div class="login-container">
                <div class="login-logo">‚ö°</div>
                <h2 class="login-title">NetQuiz</h2>
                <p class="login-subtitle">Sign in or create an account to start studying</p>

                <!-- Login Form -->
                <div id="login-form" class="login-card card">
                    <div class="form-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" class="form-input" placeholder="Enter username"
                            autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-input" placeholder="Enter password"
                            autocomplete="current-password">
                    </div>
                    <p class="login-error" id="login-error" style="display:none"></p>
                    <button class="btn btn-primary btn-full" id="login-btn" onclick="handleLogin()">Sign In</button>
                    <p class="auth-switch">Don't have an account? <a href="#"
                            onclick="showRegisterForm(); return false;">Create one</a></p>
                </div>

                <!-- Registration Form -->
                <div id="register-form" class="login-card card" style="display:none">
                    <div class="form-group">
                        <label for="reg-username">Username</label>
                        <input type="text" id="reg-username" class="form-input" placeholder="Choose a username"
                            autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password</label>
                        <input type="password" id="reg-password" class="form-input" placeholder="Choose a password"
                            autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm">Confirm Password</label>
                        <input type="password" id="reg-confirm" class="form-input" placeholder="Confirm password"
                            autocomplete="new-password">
                    </div>
                    <p class="login-error" id="register-error" style="display:none"></p>
                    <button class="btn btn-primary btn-full" id="register-btn" onclick="handleRegister()">Create
                        Account</button>
                    <p class="auth-switch">Already have an account? <a href="#"
                            onclick="showLoginForm(); return false;">Sign in</a></p>
                </div>
            </div>
        </div>

        <!-- Loading View -->
        <div id="loading" class="view">
            <div class="loading-container">
                <div class="spinner"></div>
                <p>Loading questions‚Ä¶</p>
            </div>
        </div>

        <!-- Home View -->
        <div id="home" class="view">
            <!-- Tier Usage Indicator -->
            <div class="tier-usage" id="tier-usage-indicator"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-value" id="stat-total-quizzes">0</span>
                    <span class="stat-label">Quizzes Taken</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-avg-score">0%</span>
                    <span class="stat-label">Avg Score</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value">
                        <span id="stat-questions-seen">0</span>
                        <span style="font-size:0.875rem;color:var(--text-secondary)">/ <span
                                id="stat-total-questions">0</span></span>
                    </span>
                    <span class="stat-label">Questions Covered</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-streak">0üî•</span>
                    <span class="stat-label">Day Streak</span>
                </div>
            </div>

            <div class="card" id="mastery-summary"></div>

            <p class="start-info" id="start-info">Loading‚Ä¶</p>

            <div class="level-section">
                <h3 class="section-title">Campaign Mode</h3>
                <div id="level-grid" class="level-grid"></div>
            </div>

            <div class="home-actions">
                <button class="btn btn-secondary btn-full" onclick="showModeSelector()">üéØ Practice Modes</button>
                <div class="btn-row">
                    <button class="btn btn-secondary" onclick="showDashboard()">üìä Progress</button>
                    <button class="btn btn-secondary" onclick="showRoadmapView()">üó∫Ô∏è Roadmap</button>
                </div>
            </div>

            <!-- Upgrade Button (visible for free users) -->
            <button class="btn btn-upgrade upgrade-btn-global" onclick="handleOneClickUpgrade()">
                ‚ö° Upgrade to Pro ‚Äì Unlock Full Access
            </button>
            <p id="total-available" style="display:none"></p>
        </div>

        <!-- Mode Selection View -->
        <div id="mode-select" class="view">
            <div class="card">
                <h2 class="section-title">Choose Practice Mode</h2>
                <div id="mode-cards" class="mode-grid"></div>
            </div>
            <button class="btn btn-secondary btn-full" onclick="goHome()" style="margin-top:12px">‚Üê Back</button>
        </div>

        <!-- Quiz View -->
        <div id="quiz" class="view">
            <div class="exam-timer-bar" id="exam-timer-bar" style="display:none">
                <span>‚è±Ô∏è <span id="timer-display">90:00</span></span>
                <span class="timer-label">Exam Mode</span>
            </div>
            <p class="progress-text" id="progress-text">Question 1 of 10</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width:10%"></div>
            </div>
            <div class="card" id="question-container"></div>
            <div class="quiz-nav">
                <div class="btn-group">
                    <button class="btn btn-secondary" id="btn-prev" onclick="prevQuestion()">‚Üê Prev</button>
                    <button class="btn btn-secondary" id="btn-next" onclick="nextQuestion()">Next ‚Üí</button>
                </div>
                <button class="btn btn-primary" id="btn-submit" onclick="submitQuiz()">Submit Quiz</button>
                <button class="btn btn-primary" id="btn-results" onclick="showResults()" style="display:none">View
                    Results ‚Üí</button>
            </div>

            <!-- Upgrade Button in Quiz -->
            <button class="btn btn-upgrade upgrade-btn-global" onclick="handleOneClickUpgrade()">
                ‚ö° Upgrade to Pro ‚Äì Unlock Full Access
            </button>
        </div>

        <!-- Results View -->
        <div id="results" class="view">
            <div class="card" style="text-align:center">
                <span class="mode-badge" id="results-mode-badge">Normal</span>
                <h2 style="margin:8px 0 4px">Session Complete</h2>
                <p style="color:var(--text-secondary);font-size:0.875rem">
                    Streak: <span id="results-streak">0üî•</span>
                </p>
                <div class="score-ring-container">
                    <div class="score-ring">
                        <svg width="140" height="140">
                            <circle class="score-ring-bg" cx="70" cy="70" r="54"></circle>
                            <circle class="score-ring-progress" id="score-ring-progress" cx="70" cy="70" r="54"
                                stroke-dasharray="339.29" stroke-dashoffset="339.29"></circle>
                        </svg>
                        <div class="score-ring-text">
                            <span class="score-big" id="results-pct">0%</span>
                            <span class="score-label" id="results-score">0 / 10</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="results-usage-note" style="display:none"></div>
            <div class="card" id="results-incorrect"></div>
            <div class="results-actions">
                <button class="btn btn-secondary" onclick="redoSet(sessionStartIndex)">üîÑ Redo Set</button>
                <button class="btn btn-primary" onclick="startQuiz()">‚ñ∂ Next Session</button>
                <button class="btn btn-secondary" onclick="goHome()">‚Üê Home</button>
            </div>

            <!-- Upgrade Button in Results -->
            <button class="btn btn-upgrade upgrade-btn-global" onclick="handleOneClickUpgrade()">
                ‚ö° Upgrade to Pro ‚Äì Unlock Full Access
            </button>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard" class="view">
            <!-- Hero: Overall Progress -->
            <div class="dash-hero">
                <div class="dash-hero-left">
                    <div class="dash-hero-label">Overall Progress</div>
                    <div class="dash-hero-value" id="dash-set-progress">Set 0 / 0</div>
                </div>
                <div class="dash-hero-bar-wrap">
                    <div class="dash-hero-bar" id="dash-set-bar" style="width:0%"></div>
                </div>
            </div>

            <!-- Compact Stats Row -->
            <div class="dash-stats-row">
                <div class="dash-stat-chip">
                    <span class="dash-chip-val" id="dash-total">0</span>
                    <span class="dash-chip-label">Quizzes</span>
                </div>
                <div class="dash-stat-chip">
                    <span class="dash-chip-val" id="dash-avg">0%</span>
                    <span class="dash-chip-label">Avg</span>
                </div>
                <div class="dash-stat-chip accent">
                    <span class="dash-chip-val" id="dash-streak-current">0</span>
                    <span class="dash-chip-label">Streak üî•</span>
                </div>
                <div class="dash-stat-chip">
                    <span class="dash-chip-val" id="dash-streak-best">0</span>
                    <span class="dash-chip-label">Best</span>
                </div>
                <div class="dash-stat-chip good">
                    <span class="dash-chip-val" id="dash-best">‚Äî</span>
                    <span class="dash-chip-label">Best Session</span>
                </div>
                <div class="dash-stat-chip bad">
                    <span class="dash-chip-val" id="dash-worst">‚Äî</span>
                    <span class="dash-chip-label">Worst</span>
                </div>
            </div>

            <!-- Latest Session Summary -->
            <div class="card dash-latest-card" id="dash-latest-session" style="display:none">
                <h3 class="dash-section-title">üìã Latest Session</h3>
                <div id="dash-latest-content"></div>
            </div>

            <!-- Topic Mastery (Collapsible) -->
            <div class="card">
                <div class="dash-section-header" onclick="toggleDashSection('topic-mastery-body')">
                    <h3 class="dash-section-title">üìä Topic Mastery</h3>
                    <span class="dash-section-chevron" id="chevron-topic-mastery-body">‚ñº</span>
                </div>
                <div id="topic-mastery-body" class="dash-collapsible" style="display:none">
                    <div id="topic-stats-container"></div>
                </div>
            </div>

            <!-- Session History (Collapsible) -->
            <div class="card">
                <div class="dash-section-header" onclick="toggleDashSection('session-history-wrap')">
                    <h3 class="dash-section-title">üìÖ Session History</h3>
                    <span class="dash-section-chevron" id="chevron-session-history-wrap">‚ñº</span>
                </div>
                <div id="session-history-wrap" class="dash-collapsible" style="display:none">
                    <div id="session-history-cards"></div>
                </div>
            </div>

            <!-- Incorrect Log (Collapsible) -->
            <div class="card">
                <div class="dash-section-header" onclick="toggleDashSection('dash-incorrect-wrap')">
                    <h3 class="dash-section-title">‚ùå Incorrect Answers</h3>
                    <span class="dash-section-chevron" id="chevron-dash-incorrect-wrap">‚ñº</span>
                </div>
                <div id="dash-incorrect-wrap" class="dash-collapsible" style="display:none">
                    <div id="dash-incorrect-list"></div>
                </div>
            </div>

            <div class="results-actions">
                <button class="btn btn-secondary" onclick="goHome()">‚Üê Home</button>
                <button class="btn btn-danger" onclick="confirmResetProgress()">üóë Reset Progress</button>
            </div>
        </div>

        <!-- Roadmap View -->
        <div id="roadmap" class="view">
            <div class="card">
                <div id="roadmap-content"></div>
            </div>

            <!-- Upgrade Button in Roadmap -->
            <button class="btn btn-upgrade upgrade-btn-global" onclick="handleOneClickUpgrade()">
                ‚ö° Upgrade to Pro ‚Äì Unlock Full Access
            </button>

            <button class="btn btn-secondary btn-full" onclick="goHome()" style="margin-top:12px">‚Üê Home</button>
        </div>

        <!-- Settings View -->
        <div id="settings" class="view">
            <div class="card">
                <h2 class="section-title">Settings</h2>

                <!-- Subscription Tier -->
                <div class="settings-section">
                    <h3 class="settings-subtitle">Subscription</h3>
                    <div id="settings-tier-display" class="tier-display"></div>
                    <div class="form-group">
                        <label>Pro Activation Key</label>
                        <div class="pro-key-row">
                            <input type="password" id="input-pro-key" class="form-input" placeholder="Enter Pro Key">
                            <button class="btn btn-primary btn-sm" onclick="handleActivatePro()">Activate</button>
                        </div>
                        <p class="login-error" id="pro-key-error" style="display:none"></p>
                    </div>
                </div>

                <hr class="divider">

                <!-- AI Settings -->
                <div class="settings-section">
                    <h3 class="settings-subtitle">AI Configuration</h3>
                    <div class="form-group">
                        <label>DeepSeek API Key</label>
                        <input type="password" id="input-api-key" class="form-input" placeholder="sk-...">
                    </div>

                    <div class="form-group">
                        <label>API Endpoint</label>
                        <input type="text" id="input-api-endpoint" class="form-input"
                            placeholder="https://api.deepseek.com/v1/chat/completions">
                    </div>

                    <div class="form-group">
                        <label>Model</label>
                        <input type="text" id="input-api-model" class="form-input" placeholder="deepseek-chat">
                    </div>

                    <div class="form-group">
                        <label>AI Explanation Mode</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="explainMode" value="beginner" id="mode-beginner"> Beginner
                                (simple, analogy-based)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="explainMode" value="technical" id="mode-technical"> Technical
                                (cert-level detail)
                            </label>
                        </div>
                    </div>
                </div>

                <hr class="divider">

                <!-- Exam Settings -->
                <div class="settings-section">
                    <h3 class="settings-subtitle">Exam Simulation</h3>
                    <div class="form-group">
                        <label>Exam Duration (minutes)</label>
                        <input type="number" id="input-exam-duration" class="form-input" value="90" min="10" max="240">
                    </div>

                    <div class="form-group">
                        <label>Exam Question Count</label>
                        <input type="number" id="input-exam-count" class="form-input" value="60" min="10" max="200">
                    </div>
                </div>

                <div class="btn-row" style="margin-top:20px">
                    <button class="btn btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
                    <button class="btn btn-secondary" onclick="goHome()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Checkout Modal (multi-step) -->
        <div id="checkout-modal" class="modal-overlay" style="display:none">
            <div class="checkout-card">

                <!-- Step 1: Plan Selection -->
                <div id="checkout-step-plans" class="checkout-step">
                    <button class="checkout-close" onclick="closeCheckout()" title="Close">&times;</button>
                    <div class="checkout-header">
                        <span class="modal-icon">‚ö°</span>
                        <h2>Choose Your Plan</h2>
                        <p id="checkout-usage-text" class="checkout-subtitle">Unlock unlimited access to everything</p>
                    </div>

                    <div class="checkout-steps-indicator">
                        <span class="step-dot active"></span>
                        <span class="step-line"></span>
                        <span class="step-dot"></span>
                        <span class="step-line"></span>
                        <span class="step-dot"></span>
                    </div>

                    <div class="plan-cards">
                        <div class="plan-card" onclick="selectPlan('monthly')" id="plan-monthly">
                            <div class="plan-name">Monthly</div>
                            <div class="plan-price">R99<span>/mo</span></div>
                            <ul class="plan-perks">
                                <li>‚úÖ Unlimited questions</li>
                                <li>‚úÖ All practice modes</li>
                                <li>‚úÖ Live AI explanations</li>
                                <li>‚úÖ Exam simulation</li>
                            </ul>
                            <div class="plan-tag">Flexible</div>
                        </div>

                        <div class="plan-card popular" onclick="selectPlan('annual')" id="plan-annual">
                            <div class="plan-badge-popular">Most Popular</div>
                            <div class="plan-name">Annual</div>
                            <div class="plan-price">R699<span>/yr</span></div>
                            <div class="plan-savings">Save 41% ‚Äî R58/mo</div>
                            <ul class="plan-perks">
                                <li>‚úÖ Everything in Monthly</li>
                                <li>‚úÖ Priority support</li>
                                <li>‚úÖ AI roadmap analysis</li>
                            </ul>
                            <div class="plan-tag">Best Value</div>
                        </div>

                        <div class="plan-card" onclick="selectPlan('lifetime')" id="plan-lifetime">
                            <div class="plan-name">Lifetime</div>
                            <div class="plan-price">R1,499<span> once</span></div>
                            <div class="plan-savings">Pay once, access forever</div>
                            <ul class="plan-perks">
                                <li>‚úÖ Everything in Annual</li>
                                <li>‚úÖ Future updates free</li>
                                <li>‚úÖ Lifetime access</li>
                            </ul>
                            <div class="plan-tag">Forever</div>
                        </div>
                    </div>

                    <div class="checkout-footer">
                        <button class="btn btn-secondary" onclick="closeCheckout()">Maybe Later</button>
                    </div>
                </div>

                <!-- Step 2: Payment Form -->
                <div id="checkout-step-payment" class="checkout-step" style="display:none">
                    <button class="checkout-close" onclick="closeCheckout()" title="Close">&times;</button>
                    <div class="checkout-header">
                        <h2>Payment Details</h2>
                        <p class="checkout-subtitle">
                            <span id="payment-plan-label">Annual Plan</span> ‚Äî <strong
                                id="payment-plan-price">R699/yr</strong>
                        </p>
                    </div>

                    <div class="checkout-steps-indicator">
                        <span class="step-dot completed">‚úì</span>
                        <span class="step-line active"></span>
                        <span class="step-dot active"></span>
                        <span class="step-line"></span>
                        <span class="step-dot"></span>
                    </div>

                    <form id="payment-form" onsubmit="return handlePayment(event)">
                        <div class="payment-field">
                            <label for="pay-name">Cardholder Name</label>
                            <input type="text" id="pay-name" class="form-input" placeholder="Name on card" required
                                autocomplete="cc-name">
                        </div>

                        <div class="payment-field">
                            <label for="pay-card">Card Number</label>
                            <div class="card-input-wrap">
                                <input type="text" id="pay-card" class="form-input" placeholder="1234 5678 9012 3456"
                                    maxlength="19" required autocomplete="cc-number" inputmode="numeric">
                                <span class="card-brand" id="card-brand-icon">üí≥</span>
                            </div>
                        </div>

                        <div class="payment-row">
                            <div class="payment-field">
                                <label for="pay-expiry">Expiry</label>
                                <input type="text" id="pay-expiry" class="form-input" placeholder="MM/YY" maxlength="5"
                                    required autocomplete="cc-exp" inputmode="numeric">
                            </div>
                            <div class="payment-field">
                                <label for="pay-cvv">CVV</label>
                                <input type="text" id="pay-cvv" class="form-input" placeholder="123" maxlength="4"
                                    required autocomplete="cc-csc" inputmode="numeric">
                            </div>
                        </div>

                        <div class="payment-field">
                            <label for="pay-email">Email (for receipt)</label>
                            <input type="email" id="pay-email" class="form-input" placeholder="you@example.com" required
                                autocomplete="email">
                        </div>

                        <div id="payment-error" class="payment-error" style="display:none"></div>

                        <div class="payment-secure">
                            üîí Secured with 256-bit SSL encryption
                        </div>

                        <div class="checkout-footer">
                            <button type="button" class="btn btn-secondary" onclick="showCheckoutStep('plans')">‚Üê
                                Back</button>
                            <button type="submit" class="btn btn-primary btn-upgrade-modal" id="pay-submit-btn">
                                üí≥ Pay <span id="pay-btn-amount">R699</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Step 3: Processing -->
                <div id="checkout-step-processing" class="checkout-step" style="display:none">
                    <div class="checkout-header">
                        <div class="processing-spinner"></div>
                        <h2>Processing Payment</h2>
                        <p class="checkout-subtitle" id="processing-status">Verifying your card details‚Ä¶</p>
                    </div>

                    <div class="checkout-steps-indicator">
                        <span class="step-dot completed">‚úì</span>
                        <span class="step-line completed"></span>
                        <span class="step-dot completed">‚úì</span>
                        <span class="step-line active"></span>
                        <span class="step-dot active"></span>
                    </div>

                    <div class="processing-stages">
                        <div class="processing-stage" id="proc-verify">
                            <span class="proc-icon">‚è≥</span> Verifying card details‚Ä¶
                        </div>
                        <div class="processing-stage" id="proc-charge">
                            <span class="proc-icon">‚è≥</span> Processing payment‚Ä¶
                        </div>
                        <div class="processing-stage" id="proc-activate">
                            <span class="proc-icon">‚è≥</span> Activating Pro features‚Ä¶
                        </div>
                    </div>
                </div>

                <!-- Step 4: Success -->
                <div id="checkout-step-success" class="checkout-step" style="display:none">
                    <div class="checkout-header">
                        <span class="modal-icon success-icon">üéâ</span>
                        <h2>Welcome to Pro!</h2>
                        <p class="checkout-subtitle">Your upgrade is complete</p>
                    </div>

                    <div class="checkout-steps-indicator">
                        <span class="step-dot completed">‚úì</span>
                        <span class="step-line completed"></span>
                        <span class="step-dot completed">‚úì</span>
                        <span class="step-line completed"></span>
                        <span class="step-dot completed">‚úì</span>
                    </div>

                    <div class="success-details">
                        <div class="success-plan" id="success-plan-name">Annual Plan ‚Äî R699/yr</div>
                        <div class="success-receipt">
                            <p>Receipt sent to <strong id="success-email">your email</strong></p>
                            <p class="success-ref">Ref: <span id="success-ref-id">NQ-000000</span></p>
                        </div>
                        <ul class="success-unlocked">
                            <li>üîì Unlimited questions</li>
                            <li>üîì All practice modes</li>
                            <li>üîì Live AI explanations</li>
                            <li>üîì Exam simulation mode</li>
                            <li>üîì AI roadmap analysis</li>
                        </ul>
                    </div>

                    <div class="checkout-footer">
                        <button class="btn btn-primary btn-upgrade-modal" onclick="closeCheckoutSuccess()">üöÄ Start
                            Learning</button>
                    </div>
                </div>

                <!-- Step 4b: Failure -->
                <div id="checkout-step-failed" class="checkout-step" style="display:none">
                    <div class="checkout-header">
                        <span class="modal-icon">‚ùå</span>
                        <h2>Payment Failed</h2>
                        <p class="checkout-subtitle" id="failure-reason">Your card was declined. Please try again.</p>
                    </div>

                    <div class="checkout-footer">
                        <button class="btn btn-primary" onclick="showCheckoutStep('payment')">üîÑ Try Again</button>
                        <button class="btn btn-secondary" onclick="closeCheckout()">Cancel</button>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <!-- Scripts (order matters: dependencies first) -->
    <script src="storage.js"></script>
    <script src="subscription.js"></script>
    <script src="config.js"></script>
    <script src="tracking.js"></script>
    <script src="parser.js"></script>
    <script src="progress.js"></script>
    <script src="ai.js"></script>
    <script src="modes.js"></script>
    <script src="roadmap.js"></script>
    <script src="quiz.js"></script>
    <script src="auth.js"></script>
</body>

</html>